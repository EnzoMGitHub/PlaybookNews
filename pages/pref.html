<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <link rel="stylesheet" href="/styles.css" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        body {
            color: white;
        }
        .conferences {
            flex: 1 1 0;
            padding: 1.25rem;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            min-width: 0;
            background: rgba(0,0,0,0.35);
            box-shadow: 0 12px 32px rgba(0,0,0,0.25);
        }
        .divisions {
            margin:0 0 .25rem 0;
            font-size: 1.5rem; /* back to heading size */
        }
        .conference-legend {
            padding: 0 0.4rem;
            font-size: 1.6rem;
            text-align: center;
            width: 100%;
        }
        .team-list {
            margin:0;
            padding-left:0;
            list-style:none;
        }
        .team-list label{
            display: block;
            padding: 4px 0;
            font-size: 1rem;
        }
    </style>

    <title>PlaybookNews</title>
  </head>
  <body>

    <div class="container py-5"> 
      <h1 class="text-center mb-4">Select Your Team</h1>
      <form id="team-form" action="/preferences" method="post" style="max-width:1200px;width:100%;margin:0 auto;">
        <div class="row g-4">
            <!-- AFC -->
            <div class="col-md-6">
              <fieldset class="conferences border border-danger-subtle h-100">
                <legend class="fw-bold text-danger conference-legend mx-auto">American Football Conference</legend>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">AFC East</h4>
                    <ul class="team-list">
                    <label><input type="radio" class="form-check-input me-2" name="team" value="Buffalo Bills" id="team-bills"> Buffalo Bills</label>
                    <label><input type="radio" class="form-check-input me-2" name="team" value="Miami Dolphins" id="team-dolphins"> Miami Dolphins</label>
                    <label><input type="radio" class="form-check-input me-2" name="team" value="New England Patriots" id="team-patriots"> New England Patriots</label>
                    <label><input type="radio" class="form-check-input me-2" name="team" value="New York Jets" id="team-jets"> New York Jets</label>
                    </ul>
                </div>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">AFC North</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Baltimore Ravens" id="team-ravens"> Baltimore Ravens</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Cincinnati Bengals" id="team-bengals"> Cincinnati Bengals</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Cleveland Browns" id="team-browns"> Cleveland Browns</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Pittsburgh Steelers" id="team-steelers"> Pittsburgh Steelers</label>
                    </ul>
                </div>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">AFC South</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Houston Texans" id="team-texans"> Houston Texans</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Indianapolis Colts" id="team-colts"> Indianapolis Colts</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Jacksonville Jaguars" id="team-jaguars"> Jacksonville Jaguars</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Tennessee Titans" id="team-titans"> Tennessee Titans</label>
                    </ul>
                </div>

                <div>
                    <h4 class="divisions">AFC West</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Kansas City Chiefs" id="team-chiefs"> Kansas City Chiefs</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Denver Broncos" id="team-broncos"> Denver Broncos</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Las Vegas Raiders" id="team-raiders"> Las Vegas Raiders</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Los Angeles Chargers" id="team-chargers"> Los Angeles Chargers</label>
                    </ul>
                </div>
              </fieldset>
            </div>

            <!-- NFC -->
            <div class="col-md-6">
              <fieldset class="conferences border border-primary-subtle h-100">
                <legend class="fw-bold text-primary conference-legend mx-auto">National Football Conference</legend>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">NFC East</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Philadelphia Eagles" id="team-eagles"> Philadelphia Eagles</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Dallas Cowboys" id="team-cowboys"> Dallas Cowboys</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Washington Commanders" id="team-commanders"> Washington Commanders</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="New York Giants" id="team-giants"> New York Giants</label>
                    </ul>
                </div>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">NFC North</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Green Bay Packers" id="team-packers"> Green Bay Packers</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Minnesota Vikings" id="team-vikings"> Minnesota Vikings</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Chicago Bears" id="team-bears"> Chicago Bears</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Detroit Lions" id="team-lions"> Detroit Lions</label>
                    </ul>
                </div>

                <div style="margin-bottom:0.75rem">
                    <h4 class="divisions">NFC South</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Tampa Bay Buccaneers" id="team-buccaneers"> Tampa Bay Buccaneers</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="New Orleans Saints" id="team-saints"> New Orleans Saints</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Atlanta Falcons" id="team-falcons"> Atlanta Falcons</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Carolina Panthers" id="team-panthers"> Carolina Panthers</label>
                    </ul>
                </div>

                <div>
                    <h4 class="divisions">NFC West</h4>
                    <ul class="team-list">
                        <label><input type="radio" class="form-check-input me-2" name="team" value="San Francisco 49ers" id="team-49ers"> San Francisco 49ers</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Seattle Seahawks" id="team-seahawks"> Seattle Seahawks</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Los Angeles Rams" id="team-rams"> Los Angeles Rams</label>
                        <label><input type="radio" class="form-check-input me-2" name="team" value="Arizona Cardinals" id="team-cardinals"> Arizona Cardinals</label>
                    </ul>
                </div>
              </fieldset>
            </div>
        </div>

        <div class="mt-4 text-center">
            <button type="submit" class="btn btn-primary">Save Team</button>
        </div>
      </form>
    </div>
    <pre id="out"></pre>
    <script>
        // Event Listener Function for Team Submission
        // Brief: Posts the submitted team to the user's preferences object
        document.getElementById('team-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            const form = e.target;
            const formData = new FormData(form);
            const team = formData.get('team');

            if (!team) {
                document.getElementById('out').textContent = 'Please select a team before saving.';
                return;
            }

            const response = await fetch('/api/preferences', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ preferences: { team } }),
                credentials: 'include'
            });

            let result = {};
            try {
              result = await response.json();
            } catch (err) {
              document.getElementById('out').textContent = 'An error occurred. Please try again.';
              return;
            }

            if (response.ok) {
                document.getElementById('out').textContent = 'Team preference saved successfully!';
                window.location.href = '/';
            } else {
                document.getElementById('out').textContent = result.error || 'An error occurred. Please try again.';
            }
        });
    </script>
  </body>
</html>
